{% extends 'core/base_public.html' %}
{% load static %}

{% block title %}Contact Us | SikshaSetu{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'core/css/contact.css' %}">
{% endblock %}

{% block content %}
<section class="contact-section">
    <div class="contact-container">
        <div class="contact-wrapper">

            <!-- LEFT : INFO -->
            <div class="contact-info">
                <h2>Get in Touch</h2>
                <p>Have questions or want to join our teaching community? We'd love to hear from you!</p>

                <div class="info-item">
                    <i class="fas fa-envelope"></i>
                    <span>support@sikshasetu.com</span>
                </div>
                <div class="info-item">
                    <i class="fas fa-phone-alt"></i>
                    <span>(+977) 9808000000</span>
                </div>
                <div class="info-item">
                    <i class="fas fa-map-marker-alt"></i>
                    <span>Kathmandu, Nepal</span>
                </div>

                <p class="small text-white-50 fst-italic mt-5">
                    "Education is the passport to the future."
                </p>
            </div>

            <!-- RIGHT : FORM -->
            <div class="contact-form">

                {% if messages %}
                    {% for message in messages %}
                        <div class="alert alert-{{ message.tags }}">{{ message }}</div>
                    {% endfor %}
                {% endif %}

                <h3 class="mb-4 fw-bold" style="color: var(--primary-blue);">
                    Send us a Message
                </h3>

                <form id="contactForm"
                      method="POST"
                      action="{% url 'core:contact' %}"
                      enctype="multipart/form-data"
                      novalidate>

                    {% csrf_token %}

                    <!-- BASIC INFO -->
                    <div class="row">
                        <div class="col-md-6 form-group">
                            <label>Full Name *</label>
                            {{ form.full_name }}
                            <div class="invalid-feedback">
                                {{ form.full_name.errors|first|default:"Full name is required." }}
                            </div>
                        </div>

                        <div class="col-md-6 form-group">
                            <label>Email *</label>
                            {{ form.email }}
                            <div class="invalid-feedback">
                                {{ form.email.errors|first|default:"Valid email required." }}
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Phone (Optional)</label>
                        {{ form.phone }}
                    </div>

                    <!-- PURPOSE -->
                    <div class="form-group">
                        <label>Purpose *</label>
                        <select name="enquiry_type"
                                id="purpose"
                                class="form-control-custom"
                                required
                                onchange="toggleFields()">

                            <option value=""
                                disabled
                                {% if not form.enquiry_type.value %}selected{% endif %}>
                                Select purpose
                            </option>

                            <option value="GENERAL"
                                {% if form.enquiry_type.value|default_if_none:"" == "GENERAL" %}selected{% endif %}>
                                General Inquiry
                            </option>

                            <option value="TEACHER"
                                {% if form.enquiry_type.value|default_if_none:"" == "TEACHER" %}selected{% endif %}>
                                Enquiry about Teacher
                            </option>

                            <option value="instructor"
                                {% if request.POST.enquiry_type == "instructor" %}selected{% endif %}>
                                Apply as Instructor
                            </option>
                        </select>

                        <div class="invalid-feedback">Please select a purpose.</div>
                    </div>

                    <!-- TEACHER SELECT -->
                    <div id="teacherField" class="form-group d-none">
                        <label>Select Teacher *</label>
                        {{ form.teacher }}
                        <div class="invalid-feedback">Please select a teacher.</div>
                    </div>

                    <!-- INSTRUCTOR ONLY -->
                    <div id="instructorFields" class="d-none">
                        <div class="alert alert-info small">
                            Instructor applications are reviewed by admin.
                        </div>

                        <div class="row">
                            <div class="col-md-6 form-group">
                                <label>Expertise *</label>
                                {{ instructor_form.expertise }}
                            </div>

                            <div class="col-md-6 form-group">
                                <label>Experience (Years) *</label>
                                {{ instructor_form.experience }}
                            </div>
                        </div>

                        <div class="form-group">
                            <label>Upload CV *</label>
                            {{ instructor_form.cv }}
                        </div>
                    </div>

                    <!-- MESSAGE -->
                    <div id="messageSection">
                        <div class="form-group">
                            <label>Subject *</label>
                            {{ form.subject }}
                        </div>

                        <div class="form-group">
                            <label>Message *</label>
                            {{ form.message }}
                        </div>
                    </div>

                    <button type="submit" class="btn-submit">
                        Send Message
                    </button>
                </form>
            </div>
        </div>
    </div>
</section>

<!-- JS -->
<script>
function toggleFields() {
    const purpose = document.getElementById('purpose')?.value;
    const instructor = document.getElementById('instructorFields');
    const teacher = document.getElementById('teacherField');
    const message = document.getElementById('messageSection');

    if (!purpose) return;

    instructor.classList.add('d-none');
    teacher.classList.add('d-none');
    message.classList.remove('d-none');

    if (purpose === 'instructor') {
        instructor.classList.remove('d-none');
        message.classList.add('d-none');
    }

    if (purpose === 'TEACHER') {
        teacher.classList.remove('d-none');
    }
}

window.addEventListener('load', toggleFields);
</script>

{% endblock %}
